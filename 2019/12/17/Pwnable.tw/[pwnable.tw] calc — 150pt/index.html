<!DOCTYPE HTML>
<html lang="en">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Hexo">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->

<meta name="keywords" content="" />


<meta name="description" content="处理+100情况时:
1234567891011number_pool中 number_pool[0]为pool中的数字个数,Eval()中处理“+”时:number_pool[\*number..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    Pwnable.tw/[pwnable.tw] calc — 150pt |
    
    Hexo
</title>

<link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

</head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='John Doe'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">
                        Hexo</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                Home</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Pwnable.tw/[pwnable.tw] calc — 150pt">
            
            Pwnable.tw/[pwnable.tw] calc — 150pt
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2019/12/17</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>处理+100情况时:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">number_pool中 number_pool[<span class="number">0</span>]为pool中的数字个数,Eval()中处理“+”时:</span><br><span class="line"></span><br><span class="line">number_pool[\*number_pool - <span class="number">1</span>] += number_pool[*number_pool];</span><br><span class="line"></span><br><span class="line">处理+<span class="number">100</span>时 number_pool[<span class="number">0</span>]为<span class="number">1</span></span><br><span class="line"></span><br><span class="line"> number_pool[<span class="number">0</span>] = number_pool[<span class="number">0</span>] + number_pool[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">==》number_pool[<span class="number">0</span>] =  <span class="number">1</span> + <span class="number">100</span> = <span class="number">101</span></span><br><span class="line"></span><br><span class="line">然后--*number_pool;使得number_pool[<span class="number">0</span>]=<span class="number">100</span></span><br></pre></td></tr></table></figure>



<p>如果一开始输入的为 +100+2</p>
<p>在处理+2时,一开始的+100已经使得number_pool[0] =   100,此时</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">处理+<span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> ( value1 &gt; <span class="number">0</span> )</span><br><span class="line"> &#123;</span><br><span class="line">   v4 = (*number_pool)++;                  <span class="comment">// v4为result_pool[0],存放的是pool中有多少个数字,这里v4=number的值没有加一</span></span><br><span class="line">   number_pool[v4 + <span class="number">1</span>] = value1;           <span class="comment">// 将值依次序放入</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> v4 = <span class="number">100</span></span><br><span class="line"> number_pool[<span class="number">100</span> + <span class="number">1</span>] = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">number_pool[<span class="number">101</span><span class="number">-1</span>] = number_pool[<span class="number">100</span>]  =  number_pool[<span class="number">100</span>] +number_pool[<span class="number">101</span>] ;</span><br><span class="line"></span><br><span class="line">此时number_pool[<span class="number">101</span>] = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">number_pool[<span class="number">100</span>]  += <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>在这里可以实现任意地址的读写</p>
<p>第一次扫描到“+”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    符号表中没有符号,执行symbols[count] = expr_str[i];</span><br><span class="line">    ↓</span><br><span class="line"> ► 0x80491e3 &lt;parse_expr+441&gt;    mov    edx, dword ptr [ebp - 0x84]</span><br><span class="line">   0x80491e9 &lt;parse_expr+447&gt;    mov    eax, dword ptr [ebp - 0x8c]</span><br><span class="line">   0x80491ef &lt;parse_expr+453&gt;    add    eax, edx</span><br><span class="line">   0x80491f1 &lt;parse_expr+455&gt;    movzx  eax, byte ptr [eax]</span><br><span class="line">   0x80491f4 &lt;parse_expr+458&gt;    lea    ecx, dword ptr [ebp - 0x70]</span><br><span class="line">   0x80491f7 &lt;parse_expr+461&gt;    mov    edx, dword ptr [ebp - 0x80]</span><br><span class="line">─────────────────────────────────[ STACK ]─────────────────────────────────</span><br><span class="line">00:0000│ esp  0xffffcf40 —▸ 0x80f05d8 ◂— 0x0</span><br><span class="line">01:0004│      0xffffcf44 —▸ 0x80bf7a8 ◂— xor    byte ptr [eax], al /* &apos;0&apos; */</span><br><span class="line">02:0008│      0xffffcf48 ◂— 0x0</span><br><span class="line">... ↓</span><br><span class="line">06:0018│      0xffffcf58 —▸ 0xffffd008 ◂— 0x0</span><br><span class="line">07:001c│      0xffffcf5c —▸ 0xffffd19c ◂— &apos;+100+2&apos;</span><br><span class="line">───────────────────────────────[ BACKTRACE ]───────────────────────────────</span><br><span class="line"> ► f 0  80491e3 parse_expr+441</span><br><span class="line">   f 1  80493f2 calc+121</span><br><span class="line">   f 2  8049499 main+71</span><br><span class="line">   f 3  804967a __libc_start_main+458</span><br><span class="line">───────────────────────────────────────────────────────────────────────────</span><br><span class="line">pwndbg&gt; x /wx $ebp - 0x84</span><br><span class="line">0xffffcf64:     0x00000000</span><br><span class="line">pwndbg&gt; x /wx $ebp - 0x8c</span><br><span class="line">0xffffcf5c:     0xffffd19c</span><br><span class="line">pwndbg&gt; x /s 0xffffd19c</span><br><span class="line">0xffffd19c:     &quot;+100+2&quot;</span><br><span class="line">此处执行后,symbols[0] = “+”</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> EAX  0x2b</span><br><span class="line"> EBX  0x80481b0 (_init) ◂— push   ebx</span><br><span class="line"> ECX  0x2</span><br><span class="line"> EDX  0xffffcf78 ◂— 0x2b /* &apos;+&apos; */</span><br><span class="line"> EDI  0x80ec00c (_GLOBAL_OFFSET_TABLE_+12) —▸ 0x8069120 (__stpcpy_sse2) ◂— mov    edx, dword ptr [esp + 4]</span><br><span class="line"> ESI  0x0</span><br><span class="line"> EBP  0xffffcf38 —▸ 0xffffcfe8 —▸ 0xffffd5a8 —▸ 0xffffd5c8 —▸ 0x8049c30 (__libc_csu_fini) ◂— ...</span><br><span class="line"> ESP  0xffffcf2c ◂— 0x2b /* &apos;+&apos; */</span><br><span class="line"> EIP  0x8048f1a (eval+57) ◂— mov    eax, dword ptr [ebp + 8]</span><br><span class="line">────────────────────────────────────[ DISASM ]─────────────────────────────────────</span><br><span class="line">   0x8048ee9 &lt;eval+8&gt;     mov    eax, dword ptr [ebp + 0xc]</span><br><span class="line">   0x8048eec &lt;eval+11&gt;    mov    byte ptr [ebp - 0xc], al</span><br><span class="line">   0x8048eef &lt;eval+14&gt;    movsx  eax, byte ptr [ebp - 0xc]</span><br><span class="line">   0x8048ef3 &lt;eval+18&gt;    cmp    eax, 0x2b</span><br><span class="line">   0x8048ef6 &lt;eval+21&gt;    je     eval+57 &lt;0x8048f1a&gt;</span><br><span class="line">    ↓</span><br><span class="line"> ► 0x8048f1a &lt;eval+57&gt;    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">   0x8048f1d &lt;eval+60&gt;    mov    eax, dword ptr [eax]</span><br><span class="line">   0x8048f1f &lt;eval+62&gt;    lea    edx, dword ptr [eax - 2]</span><br><span class="line">   0x8048f22 &lt;eval+65&gt;    mov    eax, dword ptr [ebp + 8]</span><br><span class="line">   0x8048f25 &lt;eval+68&gt;    mov    eax, dword ptr [eax]</span><br><span class="line">   0x8048f27 &lt;eval+70&gt;    lea    ecx, dword ptr [eax - 2]</span><br><span class="line">─────────────────────────────────────[ STACK ]─────────────────────────────────────</span><br><span class="line">00:0000│ esp  0xffffcf2c ◂— 0x2b /* &apos;+&apos; */</span><br><span class="line">01:0004│      0xffffcf30 —▸ 0x80481b0 (_init) ◂— push   ebx</span><br><span class="line">02:0008│      0xffffcf34 ◂— 0x0</span><br><span class="line">03:000c│ ebp  0xffffcf38 —▸ 0xffffcfe8 —▸ 0xffffd5a8 —▸ 0xffffd5c8 —▸ 0x8049c30 (__libc_csu_fini) ◂— ...</span><br><span class="line">04:0010│      0xffffcf3c —▸ 0x8049308 (parse_expr+734) ◂— sub    dword ptr [ebp - 0x80], 1</span><br><span class="line">05:0014│      0xffffcf40 —▸ 0xffffd008 ◂— 0x65 /* &apos;e&apos; */</span><br><span class="line">06:0018│      0xffffcf44 ◂— 0x2b /* &apos;+&apos; */</span><br><span class="line">07:001c│      0xffffcf48 ◂— 0x1</span><br><span class="line">───────────────────────────────────[ BACKTRACE ]───────────────────────────────────</span><br><span class="line"> ► f 0  8048f1a eval+57</span><br><span class="line">   f 1  8049308 parse_expr+734</span><br><span class="line">   f 2  80493f2 calc+121</span><br><span class="line">   f 3  8049499 main+71</span><br><span class="line">   f 4  804967a __libc_start_main+458</span><br><span class="line">此处观测 +2,可以看到[ebp + 8] 值为0x65 (101)</span><br></pre></td></tr></table></figure>



<p>一个函数使用的所有栈空间必须是16字节的整数倍”应该是指栈的起始地址是16的整数倍，代码“and  $0xfffffff0,%esp”应该就是保证栈指针esp是16的整数倍的</p>
<figure class="highlight plain"><figcaption><span>push    ebp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:08049453                 mov     ebp, esp</span><br><span class="line">.text:08049455                 and     esp, 0FFFFFFF0h</span><br><span class="line">.text:08049458                 sub     esp, 16</span><br></pre></td></tr></table></figure>
    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    
    <a href="/2019/11/26/Pwnable.tw/%5Bpwnable.tw%5D%20start%20%E2%80%94%20100pt/" class="next-post btn btn-default" title='Pwnable.tw/[pwnable.tw] start — 100pt'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            Pwnable.tw/[pwnable.tw] start — 100pt</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<script id="dsq-count-scr" src="https://snippet.disqus.com/count.js" async></script>

<script type="text/javascript">
var disqus_config = function() {
    this.page.url = 'http://yoursite.com/2019/12/17/Pwnable.tw/[pwnable.tw]%20calc%20%E2%80%94%20150pt/';
    this.page.identifier = '2019/12/17/Pwnable.tw/[pwnable.tw] calc — 150pt/';
    this.page.title = 'Pwnable.tw/[pwnable.tw] calc — 150pt';
};
var d = document,
    s = d.createElement('script');
s.src = 'https://snippet.disqus.com/embed.js';
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);
</script>

</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            Table of Contents
        </h3>
        
        <p>暂无目录</p>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2019
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":true}});</script></body>
</html>